---
import SocialShare from "@/components/SocialShare.astro";
import SimilarPosts from "@/components/SimilarPosts.astro";
import SEO from "@/layouts/components/SEO.astro";
import { getSinglePage } from "@/lib/contentParser.astro";
import dateFormat from "@/lib/utils/dateFormat";
import similarItems from "@/lib/utils/similarItems";
import { humanize, markdownify, slugify } from "@/lib/utils/textConverter";
import { Image } from "astro:assets";
import { render } from "astro:content";
import { BiCalendarEdit, BiCategoryAlt } from "react-icons/bi";

const allAuthors = await getSinglePage("authors");
const posts = await getSinglePage("posts");
const { post } = Astro.props;

const similarPosts = posts.filter(p => p.slug !== post.slug && p.data.category === post.data.category).slice(0, 3);
const { Content } = await render(post);
const { title, description, authors, categories, image, date, tags } = post.data;

const siteUrl = "https://txchyon.com";
const canonicalUrl = `${siteUrl}${Astro.url.pathname}`;
const ogImage = image ? `${siteUrl}${image}` : `${siteUrl}/og-default.jpg`;

// Safe author handling
const getAuthorNames = () => {
  if (!authors || !Array.isArray(authors)) return "NefuTrades";
  
  const names = authors
    .map(a => a?.data?.name)
    .filter(name => name && typeof name === 'string');
  
  return names.length > 0 ? names.join(", ") : "NefuTrades";
};

const authorNames = getAuthorNames();
---


<!-- SEO handled by Base.astro layout -->

</section>

<!-- Similar posts – untouched -->
{similarPosts.length > 0 && (
  <section class="section pt-0">
    <div class="container">
      <h2 class="mb-8 text-center h3">Similar Posts</h2>
      <!-- SimilarPosts disabled temporarily -->
    </div>
  </section>
)}
